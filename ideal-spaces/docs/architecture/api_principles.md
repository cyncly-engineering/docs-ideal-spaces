# Principles of our APIs

## URL Scheme

* We use plurals for our resource names, e.g. `projects`, `features`, `items`
* We use URL-friendly names for paths and query parameter with lower case and hyphens for spaces ([kebab-case / spinal-case](https://en.wikipedia.org/wiki/Naming_convention_(programming)), as recommended for example [here](https://developers.google.com/search/docs/advanced/guidelines/url-structure)), e.g. `feature-item-number`
* Mandatory parameters are in the path
* Other parameter to filter a search are query parameters in the URL
* Searches get a path prefix `search`, e.g.
    * `/feature-items/search/item-id/1`  
    * `/tenants/search/user-id/1?creation-date-time-from=2020-05-30TT10:36:00+00:00`  

## Responses

### HTTP status codes

We use [HTTP status codes](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes) to indicate successful or erroneous requests.

### Successful responses

If the resource / data is found and everything is fine, we return the data in a wrapping JSON object 
with the property `result` containing the actual object.
This enables us to add other metadata later on.

#### Single result

The result property contains a single object.

Either we return a successful status with the data (http status 2xx), or a 404 Not Found if no data was found.

```json title="Example"
{
  "result": {
    "itemId": 1,
    "projectId": "P-1",
    "... other fields...": ""
  }
}
```

#### Multiple results

The result property contains an array of objects.

We always return a successful status with the data (http status 2xx), the array will be empty if no data was found.

We include this metadata:

* `resultItemCount`: Allows the consumer to quickly assess the result
* `totalItemCount`: Allows the consumer to properly use the pagination later on (to set limit/offset accordingly)

```json title="Example"
{
  "result": [
    {
      "itemId": 1,
      "projectId": "P-1",
      "... other fields...": ""
    },
    {
      "itemId": 11,
      "projectId": "P-1",
      "... other fields...": ""
    }
  ],
  "resultItemCount": 2,  
  "totalItemCount": 2  
}
```

### Non-successful responses

There are different kinds of non-successful responses: A resource might still be in a wrong state (informative), a validation error happens, ...

These errors are all JSON data, they contain

* a `key` that is used by machines (other services) to interpret the kind of error
* a general `description` about the error in English so a human can read/identify it in logs/debugging; Not to be used / interpreted by machines/services
* a `trace id` to allow us/others to look at the logs (trace-ID header generated by router?? api-gateway??)
* if multiple errors can occur, they are wrapped in an array

```json title="Single error"
{
  "key": "error.validation.ABC",
  "description": "Not so good",
  "trace-id": "...."
}
```

```json title="Multiple errors"
{
  "errors": [
    {
      "key": "error.validation.ABC",
      "description": "Not so good",
    },
    {
      "key": "error.validation.YXZ",
      "description": "Worse",
    },
  ],
  "trace-id": "...."
}
```

#### Informative responses

Sometimes we cannot (yet) return the requested object as it is in the wrong state. 
For example a project was submitted by designer, but not yet processed by IS backend.

In these cases, the `key` is prefixed with `info.`.

```json title="Example"
{
  "key": "info.accepted",
  "description": "Project creation request has been accepted but has not yet completed",
  "trace-id": "...."
}
```

#### General errors

The consumer should usually make sure that all requirements for creating a project are satisfied (e.g. ), but still sometimes something could happen.

```json title="Example"
{
  "key": "error.project_not_created",
  "description": "option id? not found",
  "trace-id": "...."
}
```

#### Validation errors

When creating resources (project, feature, ...) we validate the incoming request.

In these cases, the `key` is prefixed with  `error.validation.`, and the response contains more information about the issue and which field is affected.

```json title="Example"
{
  "key": "error.validation.min_length",
  "description": "Field value is too short, expected '>= 2', was '1'",
  "fieldName": "featureName",
  "fieldValue": "E",
  "checkValue": "2",
  "trace-id": "...."
}
```
